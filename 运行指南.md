# 应用运行指南

本文档详细说明如何重新运行修复后的数据库应用程序，确保DatabaseAdapter能正确连接MongoDB并获取数据。

本应用支持多数据库配置，可以同时连接和使用MongoDB等多种数据库（其他数据库支持将在未来版本中提供）。

## 一、运行前准备

1. **确保MongoDB服务已启动**
   - 请确认您的MongoDB服务正在运行，默认连接到 `localhost:27017`
   - 确保 `admin` 数据库中的 `event` 集合已创建且包含数据

2. **环境检查**
   - 确保已安装Python和所有依赖（可通过 `pip install -r requirements.txt` 安装）
   - 项目目录结构已正确保留
   
3. **数据库配置文件（可选）**
   - 应用程序使用 `database_config.py` 文件统一管理数据库连接参数
   - 您可以根据需要修改该文件中的配置信息

## 二、启动应用程序

有两种方式可以启动应用程序：

### 方式1：使用Python启动脚本（推荐）

1. 双击运行项目根目录下的 `start_app.py` 文件
2. 该脚本会自动：
   - 设置正确的环境变量（集合名称为 `event` 等）
   - 检查MongoDB连接状态
   - 显示可用的数据库类型及其配置状态
   - 导航到应用目录
   - 启动应用程序
   - 显示应用程序输出
   - 在应用停止后保持窗口打开

### 方式2：手动命令行启动

1. 打开命令提示符（CMD）
2. 导航到项目根目录：`cd c:/Users/Linyang/Desktop/search_web`
3. 设置环境变量（基础配置）：
   ```
   SET MONGODB_COLLECTION=event
   SET DB_TYPE=mongodb
   SET MONGODB_HOST=localhost
   SET MONGODB_PORT=27017
   SET MONGODB_DB=admin
   ```
   （可选）设置身份验证信息：
   ```
   SET MONGODB_USERNAME=your_username
   SET MONGODB_PASSWORD=your_password
   ```
4. 导航到应用目录：`cd graph-database-backend_1`
5. 启动应用：`python app.py`

## 三、验证应用是否正常运行

应用启动后，可以使用以下方法验证是否正常工作：

### 方法1：使用多数据库测试脚本（推荐）

1. 打开新的命令提示符窗口
2. 导航到项目根目录
3. 运行：`python test_multi_db.py`
4. 查看输出结果，该脚本会测试所有API端点并验证多数据库功能

### 方法2：使用基础测试脚本

1. 打开新的命令提示符窗口
2. 导航到项目根目录
3. 运行：`python test_home.py`
4. 查看输出结果，确保能成功获取数据

### 方法2：使用浏览器或API测试工具

1. 打开浏览器或API测试工具（如Postman）
2. 访问以下端点：
   - 根路径：`http://localhost:5000/`
   - 获取所有事件：`http://localhost:5000/api/getAllEvents`
   - 搜索事件：`http://localhost:5000/api/searchEvents?query=关键词`

## 四、常见问题及解决方案

1. **问题：连接到MongoDB失败**
   **解决方案**：检查MongoDB服务是否正在运行，端口是否为27017

2. **问题：查询返回空结果**
   **解决方案**：确认集合名称是否正确（应为 `event`），并检查该集合中是否有数据

3. **问题：环境变量未生效**
   **解决方案**：确保在启动应用前正确设置了环境变量，可以通过批处理脚本自动设置

4. **问题：多数据库功能不正常**
   **解决方案**：检查 `database_config.py` 文件中的配置是否正确，确保数据库服务已启动

## 五、其他有用工具

- `verify_fix.py`：验证修复效果的测试脚本
- `test_db_adapter.py`：测试DatabaseAdapter功能的脚本
- `check_mongodb.py`：检查MongoDB连接状态的工具
- `test_multi_db.py`：测试多数据库功能的综合测试脚本

## 六、多数据库功能说明

### 数据库配置系统

应用程序使用 `database_config.py` 文件统一管理所有数据库的连接参数。该文件定义了 `DatabaseConfig` 类，提供了以下功能：

- 集中管理MongoDB、Nebula等数据库的配置
- 提供配置参数的获取和设置方法
- 支持环境变量覆盖配置文件
- 提供数据库可用性检查功能

### API端点支持

所有API端点现在都支持 `db_type` 参数，可以指定使用哪个数据库服务：

```
http://localhost:5000/api/getAllEvents?db_type=mongodb
http://localhost:5000/api/getEventsByKeyword?keyword=风险&db_type=mongodb
```

### 数据库状态检查

可以通过 `/db_status` 端点查看所有配置的数据库状态：

```
http://localhost:5000/db_status
```

### 默认数据库切换

可以通过 `/switch_db` 端点动态切换默认使用的数据库：

```
POST http://localhost:5000/switch_db
Content-Type: application/json

{"db_type": "mongodb"}
```

## 六、联系方式

如有任何问题，请联系系统管理员获取帮助。

---

创建时间：2024-01-25 15:30:00